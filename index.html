<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torneo Equilibrado - A & B</title>
    <style>
        :root { --primary: #2563eb; --accent: #f59e0b; --bg: #f8fafc; --text: #1e293b; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 15px; max-width: 900px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .flex-input { display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap; }
        input, select, button { padding: 10px; border-radius: 8px; border: 1px solid #cbd5e1; }
        button { background: var(--primary); color: white; border: none; cursor: pointer; font-weight: bold; }
        .btn-start { background: #059669; width: 100%; margin-top: 10px; }
        .player-item { display: flex; justify-content: space-between; align-items: center; background: #f1f5f9; padding: 8px 12px; border-radius: 6px; margin-bottom: 5px; }
        .cat-badge { padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; }
        .cat-a { background: #dcfce7; color: #166534; }
        .cat-b { background: #fef9c3; color: #854d0e; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { text-align: left; color: #64748b; font-size: 0.8rem; padding: 10px; border-bottom: 2px solid #e2e8f0; }
        td { padding: 12px 10px; border-bottom: 1px solid #f1f5f9; }
        .score-input { width: 45px; text-align: center; font-weight: bold; border: 2px solid #e2e8f0; }
        .hidden { display: none; }
        .rank-card { border-left: 4px solid var(--primary); padding: 10px; background: #fff; margin-bottom: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

    <h2 style="text-align: center; color: var(--primary);">üèÜ Torneo Pro-Am Equilibrado</h2>

    <section id="setup" class="card">
        <h3>1. Registro de Jugadores</h3>
        <p><small>Divid√≠ a los jugadores en Categor√≠a A (Mejores) y B (Resto) para parejas parejas parejas.</small></p>
        <div class="flex-input">
            <input type="text" id="pName" placeholder="Nombre..." style="flex: 2;">
            <select id="pCat" style="flex: 1;">
                <option value="A">Categor√≠a A</option>
                <option value="B" selected>Categor√≠a B</option>
            </select>
            <button onclick="addPlayer()">A√±adir</button>
        </div>
        <div id="listA"><strong>Nivel A:</strong> <span id="countA">0</span></div>
        <div id="listB" style="margin-top: 10px;"><strong>Nivel B:</strong> <span id="countB">0</span></div>
        <div id="playerDisplay" style="margin-top: 15px;"></div>
        <button id="btnGen" class="btn-start hidden" onclick="startTournament()">Generar Cruces Equilibrados</button>
    </section>

    <section id="tournament" class="card hidden">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3>Fixture</h3>
            <button onclick="showFinalResults()" style="background: var(--accent);">Finalizar</button>
        </div>
        <div id="matchesTable"></div>
    </section>

    <section id="results" class="card hidden">
        <h3>Ranking Individual</h3>
        <div id="rankingList"></div>
        <button onclick="location.reload()" style="width: 100%; margin-top: 15px; background: #64748b;">Reiniciar</button>
    </section>

    <script>
        let players = [];
        let matches = [];

        function addPlayer() {
            const name = document.getElementById('pName').value.trim();
            const cat = document.getElementById('pCat').value;
            if(name) {
                players.push({ name, cat, wins: 0, games: 0, played: 0 });
                document.getElementById('pName').value = '';
                renderPlayers();
            }
        }

        function renderPlayers() {
            const display = document.getElementById('playerDisplay');
            const catA = players.filter(p => p.cat === 'A');
            const catB = players.filter(p => p.cat === 'B');
            
            document.getElementById('countA').innerText = catA.length;
            document.getElementById('countB').innerText = catB.length;

            display.innerHTML = players.map((p, i) => `
                <div class="player-item">
                    <span>${p.name} <span class="cat-badge ${p.cat === 'A' ? 'cat-a' : 'cat-b'}">CAT ${p.cat}</span></span>
                    <button onclick="removePlayer(${i})" style="background:none; color:red; padding:0">‚úï</button>
                </div>
            `).join('');

            // Necesitamos al menos 2 de cada para armar una pareja A+B contra otra A+B
            document.getElementById('btnGen').classList.toggle('hidden', (catA.length < 2 || catB.length < 2));
        }

        function removePlayer(i) {
            players.splice(i, 1);
            renderPlayers();
        }

        function startTournament() {
            document.getElementById('setup').classList.add('hidden');
            document.getElementById('tournament').classList.remove('hidden');

            let poolA = players.filter(p => p.cat === 'A').sort(() => Math.random() - 0.5);
            let poolB = players.filter(p => p.cat === 'B').sort(() => Math.random() - 0.5);
            
            matches = [];
            // Emparejamos 1 de A con 1 de B
            let pairs = [];
            let minLen = Math.min(poolA.length, poolB.length);
            
            for(let i=0; i<minLen; i++) {
                pairs.push([poolA[i], poolB[i]]);
            }

            // Armamos enfrentamientos entre esas parejas
            for(let i=0; i < pairs.length - 1; i += 2) {
                if(pairs[i+1]) {
                    matches.push({
                        t1: pairs[i],
                        t2: pairs[i+1],
                        s1: null, s2: null
                    });
                }
            }
            renderFixture();
        }

        function renderFixture() {
            let html = `<table><tr><th>Pareja 1 (A+B)</th><th>Res.</th><th>Pareja 2 (A+B)</th></tr>`;
            matches.forEach((m, i) => {
                html += `<tr>
                    <td>${m.t1[0].name} & ${m.t1[1].name}</td>
                    <td>
                        <input type="number" class="score-input" onchange="matches[${i}].s1=parseInt(this.value)"> - 
                        <input type="number" class="score-input" onchange="matches[${i}].s2=parseInt(this.value)">
                    </td>
                    <td>${m.t2[0].name} & ${m.t2[1].name}</td>
                </tr>`;
            });
            document.getElementById('matchesTable').innerHTML = html + `</table>`;
        }

        function showFinalResults() {
            matches.forEach(m => {
                if(m.s1 === null || m.s2 === null) return;
                
                const allInMatch = [...m.t1, ...m.t2];
                allInMatch.forEach(p => p.played++);
                m.t1.forEach(p => p.games += m.s1);
                m.t2.forEach(p => p.games += m.s2);

                if(m.s1 > m.s2) m.t1.forEach(p => p.wins++);
                else if(m.s2 > m.s1) m.t2.forEach(p => p.wins++);
            });

            const sorted = [...players].sort((a,b) => b.wins - a.wins || (b.wins/b.played) - (a.wins/a.played) || b.games - a.games);
            
            document.getElementById('tournament').classList.add('hidden');
            document.getElementById('results').classList.remove('hidden');

            document.getElementById('rankingList').innerHTML = sorted.map((p, i) => `
                <div class="rank-card">
                    <strong>#${i+1} ${p.name}</strong> <span class="cat-badge ${p.cat === 'A' ? 'cat-a' : 'cat-b'}">CAT ${p.cat}</span><br>
                    Partidos Ganados: ${p.wins} | Games: ${p.games} | Eficacia: ${p.played > 0 ? ((p.wins/p.played)*100).toFixed(0) : 0}%
                </div>
            `).join('');
        }
    </script>
</body>
</html>
