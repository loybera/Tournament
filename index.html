<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torneo Pro - Sistema de Gesti칩n</title>
    <style>
        :root { --primary: #2563eb; --success: #059669; --danger: #dc2626; --bg: #f1f5f9; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 0; color: #1e293b; }
        
        /* Navegaci칩n por Solapas */
        nav { background: #1e293b; display: flex; justify-content: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .tab-btn { background: none; border: none; color: #94a3b8; padding: 15px 20px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: 0.3s; border-bottom: 3px solid transparent; }
        .tab-btn.active { color: white; border-bottom: 3px solid var(--primary); }

        .container { max-width: 1000px; margin: 20px auto; padding: 0 15px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); display: none; }
        .card.active { display: block; animation: fadeIn 0.3s ease; }

        /* Estilos de inputs y botones */
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        input, select { padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; flex: 1; }
        .btn { padding: 12px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; width: 100%; margin-top: 10px; }
        .btn-clear { background: #64748b; color: white; font-size: 0.8rem; }

        /* Jugadores y Tablas */
        .player-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #f1f5f9; }
        .cat-tag { font-size: 0.75rem; padding: 3px 8px; border-radius: 4px; background: #e2e8f0; font-weight: bold; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; padding: 12px; background: #f8fafc; border-bottom: 2px solid #e2e8f0; font-size: 0.8rem; color: #64748b; }
        td { padding: 15px 12px; border-bottom: 1px solid #f1f5f9; }
        .score-input { width: 45px; text-align: center; font-weight: bold; border: 2px solid #cbd5e1; border-radius: 4px; }

        .ranking-item { display: grid; grid-template-columns: 50px 1fr 100px 100px; padding: 15px; border-bottom: 1px solid #eee; align-items: center; }
        .pos { font-size: 1.2rem; font-weight: 800; color: var(--primary); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @media (max-width: 600px) { .ranking-item { grid-template-columns: 40px 1fr 60px; font-size: 0.8rem; } .score-input { width: 35px; } }
    </style>
</head>
<body>

    <nav>
        <button class="tab-btn active" onclick="openTab(event, 'tab-jugadores')">游논 JUGADORES</button>
        <button class="tab-btn" onclick="openTab(event, 'tab-fixture')">游 FIXTURE</button>
        <button class="tab-btn" onclick="openTab(event, 'tab-posiciones')">游끥 POSICIONES</button>
    </nav>

    <div class="container">
        
        <div id="tab-jugadores" class="card active">
            <h2>Registro de Participantes</h2>
            <div class="input-group">
                <input type="text" id="pName" placeholder="Nombre completo...">
                <select id="pCat">
                    <option value="5">Cat 5춿</option>
                    <option value="6">Cat 6춿</option>
                    <option value="7">Cat 7춿</option>
                    <option value="8">Cat 8춿</option>
                    <option value="9" selected>Cat 9춿</option>
                </select>
                <button class="btn btn-primary" onclick="addPlayer()">A침adir</button>
            </div>
            <div id="playerList"></div>
            <button class="btn btn-success" id="genBtn" onclick="generateTournament()">Generar Torneo Americano</button>
            <button class="btn btn-clear" style="margin-top: 20px; width: 100%;" onclick="clearAllData()">丘멆잺 Borrar Todo y Reiniciar</button>
        </div>

        <div id="tab-fixture" class="card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2>Fixture de Partidos</h2>
                <button class="btn btn-primary" onclick="saveData()">Guardar Progreso</button>
            </div>
            <p><small>Carg치 los resultados aqu칤 abajo. Los cambios se guardan autom치ticamente al escribir.</small></p>
            <div id="fixtureContent"></div>
        </div>

        <div id="tab-posiciones" class="card">
            <h2>Tabla de Posiciones</h2>
            <div id="rankingContent"></div>
            <button class="btn btn-success" style="margin-top:20px" onclick="calculateRanking()">Actualizar Ranking</button>
        </div>

    </div>

    <script>
        let players = JSON.parse(localStorage.getItem('torneo_players')) || [];
        let matches = JSON.parse(localStorage.getItem('torneo_matches')) || [];

        // --- L칍GICA DE SOLAPAS ---
        function openTab(evt, tabName) {
            document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');
            
            if(tabName === 'tab-posiciones') calculateRanking();
        }

        // --- L칍GICA DE JUGADORES ---
        function addPlayer() {
            const name = document.getElementById('pName').value.trim();
            const cat = parseInt(document.getElementById('pCat').value);
            if(!name) return;
            players.push({ id: Date.now(), name, cat });
            document.getElementById('pName').value = '';
            renderPlayers();
            saveData();
        }

        function removePlayer(id) {
            players = players.filter(p => p.id !== id);
            renderPlayers();
            saveData();
        }

        function renderPlayers() {
            const list = document.getElementById('playerList');
            list.innerHTML = players.map(p => `
                <div class="player-row">
                    <span><strong>${p.name}</strong> <span class="cat-tag">Cat ${p.cat}춿</span></span>
                    <button onclick="removePlayer(${p.id})" style="color:var(--danger); background:none; border:none; cursor:pointer">Eliminar</button>
                </div>
            `).join('');
            document.getElementById('genBtn').style.display = players.length >= 4 ? 'block' : 'none';
        }

        // --- L칍GICA DE FIXTURE (TODOS CONTRA TODOS EQUILIBRADO) ---
        function generateTournament() {
            if(players.length < 4) return alert("M칤nimo 4 jugadores");
            matches = [];
            
            // Generamos combinaciones 칰nicas de 4 jugadores
            for (let i = 0; i < players.length; i++) {
                for (let j = i + 1; j < players.length; j++) {
                    for (let k = j + 1; k < players.length; k++) {
                        for (let l = k + 1; l < players.length; l++) {
                            const group = [players[i], players[j], players[k], players[l]];
                            group.sort((a,b) => a.cat - b.cat); // 5 es mejor que 9
                            // Parejas: Mejor+Peor vs Medios
                            matches.push({
                                t1: [group[0].id, group[3].id],
                                t2: [group[1].id, group[2].id],
                                s1: null, s2: null
                            });
                        }
                    }
                }
            }
            matches.sort(() => Math.random() - 0.5);
            saveData();
            renderFixture();
            alert("춰Fixture generado! Pas치 a la solapa de FIXTURE.");
        }

        function renderFixture() {
            const container = document.getElementById('fixtureContent');
            if(matches.length === 0) {
                container.innerHTML = "<p>A칰n no hay partidos. Agreg치 jugadores y gener치 el torneo.</p>";
                return;
            }

            let html = `<table><tr><th>Pareja 1</th><th>Res.</th><th>Pareja 2</th></tr>`;
            matches.forEach((m, idx) => {
                const p1a = players.find(p => p.id === m.t1[0])?.name || '---';
                const p1b = players.find(p => p.id === m.t1[1])?.name || '---';
                const p2a = players.find(p => p.id === m.t2[0])?.name || '---';
                const p2b = players.find(p => p.id === m.t2[1])?.name || '---';

                html += `<tr>
                    <td>${p1a}<br>${p1b}</td>
                    <td>
                        <input type="number" class="score-input" value="${m.s1 !== null ? m.s1 : ''}" onchange="updateMatch(${idx}, 1, this.value)">
                        <input type="number" class="score-input" value="${m.s2 !== null ? m.s2 : ''}" onchange="updateMatch(${idx}, 2, this.value)">
                    </td>
                    <td>${p2a}<br>${p2b}</td>
                </tr>`;
            });
            container.innerHTML = html + `</table>`;
        }

        function updateMatch(idx, team, val) {
            const n = val === "" ? null : parseInt(val);
            if(team === 1) matches[idx].s1 = n;
            else matches[idx].s2 = n;
            saveData();
        }

        // --- L칍GICA DE RANKING ---
        function calculateRanking() {
            const stats = {};
            players.forEach(p => stats[p.id] = { name: p.name, cat: p.cat, wins: 0, played: 0, games: 0 });

            matches.forEach(m => {
                if(m.s1 === null || m.s2 === null) return;
                
                // Jugados y games
                [m.t1[0], m.t1[1], m.t2[0], m.t2[1]].forEach(id => { if(stats[id]) stats[id].played++; });
                stats[m.t1[0]].games += m.s1; stats[m.t1[1]].games += m.s1;
                stats[m.t2[0]].games += m.s2; stats[m.t2[1]].games += m.s2;

                // Victorias
                if(m.s1 > m.s2) { stats[m.t1[0]].wins++; stats[m.t1[1]].wins++; }
                else if(m.s2 > m.s1) { stats[m.t2[0]].wins++; stats[m.t2[1]].wins++; }
            });

            const sorted = Object.values(stats).sort((a,b) => b.wins - a.wins || (b.wins/b.played) - (a.wins/a.played) || b.games - a.games);
            
            const container = document.getElementById('rankingContent');
            container.innerHTML = `<div class="ranking-item" style="font-weight:bold; color:#64748b">
                <div>Pos</div><div>Jugador</div><div>Wins</div><div>Games</div>
            </div>` + sorted.map((p, i) => `
                <div class="ranking-item">
                    <div class="pos">${i+1}</div>
                    <div><strong>${p.name}</strong><br><span class="cat-tag">Cat ${p.cat}춿</span></div>
                    <div>${p.wins}</div>
                    <div style="color:var(--success); font-weight:bold">${p.games}</div>
                </div>
            `).join('');
        }

        // --- PERSISTENCIA ---
        function saveData() {
            localStorage.setItem('torneo_players', JSON.stringify(players));
            localStorage.setItem('torneo_matches', JSON.stringify(matches));
        }

        function clearAllData() {
            if(confirm("쮼st치s seguro? Se borrar치n todos los jugadores y resultados.")){
                localStorage.clear();
                location.reload();
            }
        }

        // Inicializaci칩n
        renderPlayers();
        renderFixture();
    </script>
</body>
</html>
